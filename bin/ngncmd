#!/usr/bin/env ruby

require File.dirname(__FILE__) + '/../lib/routengn'

def ask(prompt)
  print "#{prompt}: "
  return $stdin.gets.strip
end

def configure
  user = ENV['USER'] ? ENV['USER'] : `who am i`
  puts "Configuring ngncmd for #{user}..."
  site = ask "RouteNGN Site (ex. http://routengn.net)"
  key = ask "API Key"
  secret = ask "API Secret"
  print "Trying to connect... "
  begin
    if RouteNGN.connect! site, key, secret
      puts "Success"
      print "Writing config file... "
      RouteNGN.write_config
      return puts("Success")
    end
  rescue Exception
    # noop
  end
  puts "Failed"
  $stderr.puts "Please check your site and credentials and try again."
  exit 1
end

configure if ARGV[0] && ARGV[0] == '--configure' || ARGV[0] == '-c'

