#!/usr/bin/env ruby

require 'rubygems'
require 'thor'
require File.dirname(__FILE__) + '/../lib/routengn'

class NGNCommand < Thor
  map "-c" => :configure

  desc "configure", "Set up your RouteNGN API config (.ngnconf)"
  def configure
    user = ENV['USER'] ? ENV['USER'] : `who am i`
    say "Configuring ngncmd for #{user}...", :yellow
    site = ask "RouteNGN Site (ex. http://routengn.net):", :magenta
    key = ask "API Key:", :magenta
    secret = ask "API Secret:", :magenta
    say "Trying to connect... ", :yellow
    begin
      if RouteNGN.connect! site, key, secret
        say "Success", :green
        say "Writing config file... ", :yellow
        RouteNGN.write_config
        return say("Success", :green)
      end
    rescue Exception
      # noop
    end
    say "Failed", :red
    say "\nPlease check your site and credentials and try again.", :red
    exit 1
  end
end


NGNCommand.start

